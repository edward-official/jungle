<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta title="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://getbootstrap.com/docs/5.3/assets/css/docs.css"
      rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css"
    />
    <script
      defer
      src="https://use.fontawesome.com/releases/v6.4.0/js/all.js"
    ></script>

    <title>ë§ˆì´ í˜ì´ë³´ë¦¿ ë¬´ë¹„ | í”„ë¡ íŠ¸-ë°±ì—”ë“œ ì—°ê²° ë§ˆì§€ë§‰ ì˜ˆì œ!</title>

    <style>
      .center {
        text-align: center;
      }

      .sorter-box {
        width: 500px;
      }

      .movie-list {
        width: 500px;
        margin: 20px auto 0 auto;
      }

      .movie-title {
        display: inline-block;
      }

      .movie-title:hover {
        text-decoration: underline;
      }

      .card {
        margin-bottom: 15px;
      }
    </style>

    <script>
      const Sort = {
        BY_LIKES: "likes",
        BY_VIEWERS: "viewers",
        BY_DATE: "date",
      };

      let sortMode = Sort.BY_LIKES;
      let trashMode = false;

      $(document).ready(function () {
        showMovie();
        displaySorter();
        displayTrashMode(trashMode);
      });

      function showMovie() {
        $("#movie-box").empty();
        if (trashMode == false) {
          $.ajax({
            type: "GET",
            url: "/api/list",
            data: { sortMode: sortMode },
            success: function (response) {
              if (response["result"] != "success") {
                alert(sortMode + " ìˆœìœ¼ë¡œ ì˜í™” ëª©ë¡ ë°›ì•„ì˜¤ê¸° ì‹¤íŒ¨!");
                return;
              }
              let movies = response["movies_list"];
              addMovieCards(movies, false);
            },
          });
        } else {
          alert(
            "ì—¬ëŸ¬ë¶„ì´ íœ´ì§€í†µ ë³´ê¸° API ë¥¼ ë§Œë“¤ì–´ì„œ query ë¥¼ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.\nê·¸ ê²°ê³¼ë¥¼ addMovieCards() í•¨ìˆ˜ë¡œ ë„˜ê²¨ì£¼ë©´ ë©ë‹ˆë‹¤."
          );
        }
      }

      function addMovieCards(movies, trashMode) {
        for (let i = 0; i < movies.length; i++) {
          let movie = movies[i];
          let id = movie["_id"];
          let title = movie["title"];
          let viewers = movie["viewers"];
          let likes = movie["likes"];

          let cardContentHtml = `
            <img src="https://cataas.com/cat" class="movie-poster"/>
            <span class="movie-title">${title}</span>
            <span class="icon"><i class="fas fa-thumbs-up"></i></span><span class="movie-likes">${likes}</span>
            ëˆ„ì ê´€ê°ìˆ˜ <span class="movie-viewers">${viewers}</span> ëª…
            ê°œë´‰ì¼ <span class="movie-date"></span>
          `;

          let cardFooterHtml = "";
          if (trashMode == false) {
            cardFooterHtml = `
              <a href="#" onclick="likeMovie()">
              ìœ„ë¡œ!
              </a>
              <a href="#" onclick="trashMovie()">
              íœ´ì§€í†µìœ¼ë¡œ
              </a>
            `;
          } else {
            cardFooterHtml = `
              <a href="#" onclick="restoreMovie()">
              ë³µêµ¬í•˜ê¸°
              </a>
              <a href="#" onclick="deleteMovie()">
              ì˜êµ¬ì‚­ì œ
              </a>
            `;
          }

          $("#movie-box").append(`
            <div class="card">
              ${cardContentHtml}
              ${cardFooterHtml}
            </div>
          `);
        }
      }

      function likeMovie() {
        $.ajax({
          type: "POST",
          url: "/api/like",
          data: {},
          success: function (response) {
            if (response["result"] == "success") {
              alert("ì¢‹ì•„ìš” ì™„ë£Œ!");
              showMovie();
            } else {
              alert("ì¢‹ì•„ìš” ì‹¤íŒ¨ã… ã… ");
            }
          },
        });
      }

      function trashMovie() {
        alert(
          "íœ´ì§€í†µ ë³´ë‚´ê¸° ê¸°ëŠ¥ì„ ì§ì ‘ êµ¬í˜„í•´ë³´ì„¸ìš”.\nì„œë²„ ì¸¡ì— API ë¥¼ ì¶”ê°€ í›„ ì—¬ê¸°ì„œ ê·¸ API ë¥¼ í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤."
        );
      }

      function restoreMovie() {
        alert(
          "íœ´ì§€í†µì—ì„œ ë˜ì‚´ë¦¬ê¸° ê¸°ëŠ¥ì„ ì§ì ‘ êµ¬í˜„í•´ë³´ì„¸ìš”.\nì„œë²„ ì¸¡ì— API ë¥¼ ì¶”ê°€ í›„ ì—¬ê¸°ì„œ ê·¸ API ë¥¼ í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤."
        );
      }

      function deleteMovie() {
        alert(
          "íœ´ì§€í†µì—ì„œ ì•„ì£¼ ì‚­ì œ ê¸°ëŠ¥ì„ ì§ì ‘ êµ¬í˜„í•´ë³´ì„¸ìš”.\nì„œë²„ ì¸¡ì— API ë¥¼ ì¶”ê°€ í›„ ì—¬ê¸°ì„œ ê·¸ API ë¥¼ í˜¸ì¶œí•˜ë©´ ë©ë‹ˆë‹¤."
        );
      }

      function changeSorter(newMode) {
        if (sortMode == newMode) {
          return;
        }
        sortMode = newMode;
        displaySorter();
        showMovie();
      }

      function displaySorter() {
        document.getElementById("sorter-likes").classList.remove("active");
        document.getElementById("sorter-viewers").classList.remove("active");
        document.getElementById("sorter-date").classList.remove("active");
      }

      function displayTrashMode(trashMode) {
        // trashMode ì— ë”°ë¼ "íœ´ì§€í†µ ë³´ê¸°" ë˜ëŠ” "íœ´ì§€í†µ ë‚˜ê°€ê¸°" ê°€ ì¶œë ¥ ë˜ê²Œ êµ¬í˜„í•´ì•¼ ë©ë‹ˆë‹¤.
      }
    </script>
  </head>

  <body>
    <section class="hero is-warning">
      <div class="hero-body">
        <div class="container center">
          <h1 class="title">ë§ˆì´ í˜ì´ë³´ë¦¿ ë¬´ë¹„ğŸ˜†</h1>
          <h2 class="subtitle">ìˆœìœ„ë¥¼ ë§¤ê²¨ë´…ì‹œë‹¤</h2>
        </div>
      </div>
    </section>

    <div class="mx-auto sorter-box">
      <div class="btn-group m-3 mx-auto w-100">
        <a
          href="#"
          class="btn btn-primary"
          id="sorter-likes"
          onclick="changeSorter('likes')"
          >ì¢‹ì•„ìš” ìˆœìœ¼ë¡œ ì •ë ¬</a
        >
        <a
          href="#"
          class="btn btn-primary"
          id="sorter-viewers"
          onclick="changeSorter('viewers')"
          >ëˆ„ì ê´€ê°ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬</a
        >
        <a
          href="#"
          class="btn btn-primary"
          id="sorter-date"
          onclick="changeSorter('date')"
          >ê°œë´‰ì¼ ìˆœìœ¼ë¡œ ì •ë ¬</a
        >
      </div>
    </div>

    <div class="mx-auto sorter-box">
      <span class="d-flex justify-content-end">
        <div id="trash-mode-box">
          <!-- trash mode ì— ë”°ë¼ HTML element ê°€ ì‚½ì…ë©ë‹ˆë‹¤ -->
        </div>
      </span>
    </div>

    <div class="movie-list" id="movie-box">
      <!-- JavaScript ê°€ ë™ì ìœ¼ë¡œ ì˜í™” ì¹´ë“œë¥¼ ì‚½ì… -->
    </div>
  </body>
</html>
