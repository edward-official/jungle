<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta title="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://getbootstrap.com/docs/5.3/assets/css/docs.css"
      rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css"
    />
    <script
      defer
      src="https://use.fontawesome.com/releases/v6.4.0/js/all.js"
    ></script>

    <title>마이 페이보릿 무비 | 프론트-백엔드 연결 마지막 예제!</title>

    <style>
      .center {
        text-align: center;
      }

      .sorter-box {
        width: 500px;
      }

      .movie-list {
        width: 500px;
        margin: 20px auto 0 auto;
      }

      .movie-title {
        display: inline-block;
      }

      .movie-title:hover {
        text-decoration: underline;
      }

      .card {
        margin-bottom: 15px;
      }
    </style>

    <script>
      const Sort = {
        BY_LIKES: "likes",
        BY_VIEWERS: "viewers",
        BY_DATE: "date",
      };

      let sortMode = Sort.BY_LIKES;
      let trashMode = false;

      $(document).ready(function () {
        showMovie();
        displaySorter();
        displayTrashMode(trashMode);
      });

      function showMovie() {
        $("#movie-box").empty();
        if (trashMode == false) {
          $.ajax({
            type: "GET",
            url: "/api/list",
            data: { sortMode: sortMode },
            success: function (response) {
              if (response["result"] != "success") {
                alert(sortMode + " 순으로 영화 목록 받아오기 실패!");
                return;
              }
              let movies = response["movies_list"];
              addMovieCards(movies, false);
            },
          });
        } else {
          alert(
            "여러분이 휴지통 보기 API 를 만들어서 query 를 보내야 합니다.\n그 결과를 addMovieCards() 함수로 넘겨주면 됩니다."
          );
        }
      }

      function addMovieCards(movies, trashMode) {
        for (let i = 0; i < movies.length; i++) {
          let movie = movies[i];
          let id = movie["_id"];
          let title = movie["title"];
          let viewers = movie["viewers"];
          let likes = movie["likes"];

          let cardContentHtml = `
            <img src="https://cataas.com/cat" class="movie-poster"/>
            <span class="movie-title">${title}</span>
            <span class="icon"><i class="fas fa-thumbs-up"></i></span><span class="movie-likes">${likes}</span>
            누적관객수 <span class="movie-viewers">${viewers}</span> 명
            개봉일 <span class="movie-date"></span>
          `;

          let cardFooterHtml = "";
          if (trashMode == false) {
            cardFooterHtml = `
              <a href="#" onclick="likeMovie()">
              위로!
              </a>
              <a href="#" onclick="trashMovie()">
              휴지통으로
              </a>
            `;
          } else {
            cardFooterHtml = `
              <a href="#" onclick="restoreMovie()">
              복구하기
              </a>
              <a href="#" onclick="deleteMovie()">
              영구삭제
              </a>
            `;
          }

          $("#movie-box").append(`
            <div class="card">
              ${cardContentHtml}
              ${cardFooterHtml}
            </div>
          `);
        }
      }

      function likeMovie() {
        $.ajax({
          type: "POST",
          url: "/api/like",
          data: {},
          success: function (response) {
            if (response["result"] == "success") {
              alert("좋아요 완료!");
              showMovie();
            } else {
              alert("좋아요 실패ㅠㅠ");
            }
          },
        });
      }

      function trashMovie() {
        alert(
          "휴지통 보내기 기능을 직접 구현해보세요.\n서버 측에 API 를 추가 후 여기서 그 API 를 호출하면 됩니다."
        );
      }

      function restoreMovie() {
        alert(
          "휴지통에서 되살리기 기능을 직접 구현해보세요.\n서버 측에 API 를 추가 후 여기서 그 API 를 호출하면 됩니다."
        );
      }

      function deleteMovie() {
        alert(
          "휴지통에서 아주 삭제 기능을 직접 구현해보세요.\n서버 측에 API 를 추가 후 여기서 그 API 를 호출하면 됩니다."
        );
      }

      function changeSorter(newMode) {
        if (sortMode == newMode) {
          return;
        }
        sortMode = newMode;
        displaySorter();
        showMovie();
      }

      function displaySorter() {
        document.getElementById("sorter-likes").classList.remove("active");
        document.getElementById("sorter-viewers").classList.remove("active");
        document.getElementById("sorter-date").classList.remove("active");
      }

      function displayTrashMode(trashMode) {
        // trashMode 에 따라 "휴지통 보기" 또는 "휴지통 나가기" 가 출력 되게 구현해야 됩니다.
      }
    </script>
  </head>

  <body>
    <section class="hero is-warning">
      <div class="hero-body">
        <div class="container center">
          <h1 class="title">마이 페이보릿 무비😆</h1>
          <h2 class="subtitle">순위를 매겨봅시다</h2>
        </div>
      </div>
    </section>

    <div class="mx-auto sorter-box">
      <div class="btn-group m-3 mx-auto w-100">
        <a
          href="#"
          class="btn btn-primary"
          id="sorter-likes"
          onclick="changeSorter('likes')"
          >좋아요 순으로 정렬</a
        >
        <a
          href="#"
          class="btn btn-primary"
          id="sorter-viewers"
          onclick="changeSorter('viewers')"
          >누적관객수 순으로 정렬</a
        >
        <a
          href="#"
          class="btn btn-primary"
          id="sorter-date"
          onclick="changeSorter('date')"
          >개봉일 순으로 정렬</a
        >
      </div>
    </div>

    <div class="mx-auto sorter-box">
      <span class="d-flex justify-content-end">
        <div id="trash-mode-box">
          <!-- trash mode 에 따라 HTML element 가 삽입됩니다 -->
        </div>
      </span>
    </div>

    <div class="movie-list" id="movie-box">
      <!-- JavaScript 가 동적으로 영화 카드를 삽입 -->
    </div>
  </body>
</html>
